
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Equity Research Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans p-6">
  <div class="max-w-4xl mx-auto space-y-10">
    
    <h1 class="text-3xl font-bold text-center mb-2">Equity Research Report</h1>
    <div class="flex justify-center items-center gap-2 mb-6">
      <input id="tickerInput" type="text" placeholder="Enter Ticker (e.g. AAPL)" class="border px-4 py-2 rounded shadow text-sm w-60" />
      <button onclick="handleFetch()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Generate Report</button>
    </div>
    <h2 class="text-xl font-semibold text-center mb-6" id="companyName">[Awaiting Ticker]</h2>
    

    <section>
      <h2 class="text-xl font-semibold border-b pb-1 mb-2">1. Executive Summary</h2>
      <p id="execSummary" class="text-sm text-gray-700">Loading...</p>
    </section>

    <section>
      <h2 class="text-xl font-semibold border-b pb-1 mb-2">2. Company Overview</h2>
      <p id="companyOverview" class="text-sm text-gray-700">Loading...</p>
    </section>

    <section>
      <h2 class="text-xl font-semibold border-b pb-1 mb-2">3. Industry Overview</h2>
      <p id="industryOverview" class="text-sm text-gray-700">Loading...</p>
    </section>

    <section>
      <h2 class="text-xl font-semibold border-b pb-1 mb-2">4. Financial Analysis</h2>
      <p id="financials" class="text-sm text-gray-700">Loading...</p>
    </section>

    <section>
      <h2 class="text-xl font-semibold border-b pb-1 mb-2">5. Financial Projections and Valuation</h2>
      <p id="valuation" class="text-sm text-gray-700">Loading...</p>
    </section>

    <section>
      <h2 class="text-xl font-semibold border-b pb-1 mb-2">6. Investment Recommendation</h2>
      <p id="recommendation" class="text-sm text-gray-700">Loading...</p>
    </section>

    <section>
      <h2 class="text-xl font-semibold border-b pb-1 mb-2">7. Risks</h2>
      <p id="risks" class="text-sm text-gray-700">Loading...</p>
    </section>

    <section>
      <h2 class="text-xl font-semibold border-b pb-1 mb-2">8. Target Price</h2>
      <p id="targetPrice" class="text-sm text-gray-700">Loading...</p>
    </section>
  </div>

  <script>
    async function fetchReport(ticker) {
      const res = await fetch(`/.netlify/functions/stock?ticker=${ticker}`);
      const data = await res.json();

      if (!data.symbol || data.error) {
        document.getElementById("companyName").textContent = "Invalid Ticker";
        document.querySelectorAll("p").forEach(p => p.textContent = "Unable to load data.");
        return;
      }

      document.getElementById("companyName").textContent = `${data.companyName} (${data.symbol})`;

      document.getElementById("execSummary").textContent =
        `${data.companyName} is a ${data.industry} firm in the ${data.sector} sector. Currently trading at $${data.price}, with a DCF valuation of $${data.dcf.toFixed(2)}, we analyze its investment potential.`;

      document.getElementById("companyOverview").textContent =
        data.description.split('. ').slice(0, 3).join('. ') + ".";

      document.getElementById("industryOverview").textContent =
        `The ${data.industry} industry remains a key segment within the ${data.sector} sector, shaped by innovation, competitive dynamics, and macroeconomic trends.`;

      document.getElementById("financials").textContent =
        `Market Cap: $${(data.mktCap / 1e12).toFixed(2)}T, Avg Volume: ${data.volAvg.toLocaleString()}, Dividend: $${data.lastDiv}, Beta: ${data.beta}, 52W Range: ${data.range}`;

      const overValued = data.price > data.dcf;
      const diff = (data.price - data.dcf).toFixed(2);
      const pct = ((diff / data.dcf) * 100).toFixed(1);
      document.getElementById("valuation").textContent =
        `Based on DCF valuation, the stock appears ${overValued ? "overvalued" : "undervalued"} by approximately ${Math.abs(pct)}%.`;

      document.getElementById("recommendation").textContent =
        `We ${overValued ? "recommend caution at current levels" : "believe this is a buying opportunity"} based on valuation and market positioning.`;

      document.getElementById("risks").textContent =
        `Key risks include market volatility, sector-specific pressures, and macroeconomic headwinds.`;

      document.getElementById("targetPrice").textContent =
        `DCF-derived target price: $${data.dcf.toFixed(2)}. Current: $${data.price}`;
    }

    function handleFetch() {
  const ticker = document.getElementById('tickerInput').value.toUpperCase();
  if (ticker) fetchReport(ticker);
}

// Optional default
    fetchReport("AAPL");
  </script>
</body>
</html>
